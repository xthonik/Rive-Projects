<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kolesa Plus Onboarding - All Artboards</title>
  <script src="https://unpkg.com/@rive-app/webgl2@latest"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: auto;
    }
    body {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
      gap: 20px;
    }
    .artboard-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    canvas {
      width: 360px;
      height: 320px;
      background-color: rgb(26, 123, 235);
      border-radius: 8px;
    }
    .artboard-label {
      font-family: Arial, sans-serif;
      font-size: 14px;
      color: #333;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="artboard-container">
    <div class="artboard-label">Filter Artboard</div>
    <canvas id="canvas-filter"></canvas>
  </div>
  
  <div class="artboard-container">
    <div class="artboard-label">Price History Artboard</div>
    <canvas id="canvas-price-history"></canvas>
  </div>
  
  <div class="artboard-container">
    <div class="artboard-label">Subs to Search Artboard</div>
    <canvas id="canvas-subs-to-search"></canvas>
  </div>
  
  <script>
    // Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°: Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ°ÐºÐ¸Ðµ Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ñ‹ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð² Ñ„Ð°Ð¹Ð»Ðµ
    const diagnosticCanvas = document.createElement('canvas');
    diagnosticCanvas.width = 1;
    diagnosticCanvas.height = 1;
    diagnosticCanvas.style.display = 'none';
    document.body.appendChild(diagnosticCanvas);

    const diagnosticRive = new rive.Rive({
      src: 'plus_onboarding_prod.riv',
      canvas: diagnosticCanvas,
      onLoad: () => {
        console.log('ðŸ“‹ Available artboards in the file:');
        try {
          // ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ñ… Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ð°Ñ…
          console.log('File contents:', diagnosticRive.contents);

          // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð¸Ð· Ð½Ð°ÑˆÐ¸Ñ… Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ð¾Ð²
          const artboardNames = ['filter', 'price_history', 'subs_to_search'];
          artboardNames.forEach(name => {
            try {
              // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ð°
              const tempCanvas = document.createElement('canvas');
              tempCanvas.width = 1;
              tempCanvas.height = 1;
              tempCanvas.style.display = 'none';
              document.body.appendChild(tempCanvas);

              const tempRive = new rive.Rive({
                src: 'plus_onboarding_prod.riv',
                canvas: tempCanvas,
                artboard: name,
                onLoad: () => {
                  console.log(`âœ… Artboard "${name}" exists and loads successfully`);
                  tempRive.cleanup();
                  document.body.removeChild(tempCanvas);
                },
                onLoadError: (error) => {
                  console.warn(`âŒ Artboard "${name}" failed to load:`, error);
                  document.body.removeChild(tempCanvas);
                }
              });
            } catch (error) {
              console.warn(`âŒ Artboard "${name}" check failed:`, error);
            }
          });
        } catch (error) {
          console.warn('Could not get file contents:', error);
        }

        // ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ canvas
        diagnosticRive.cleanup();
        document.body.removeChild(diagnosticCanvas);
      },
      onLoadError: (error) => {
        console.error('âŒ Could not load Rive file for diagnostics:', error);
        document.body.removeChild(diagnosticCanvas);
      }
    });

    // ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ð°
    const artboards = [
      {
        canvasId: 'canvas-filter',
        artboard: 'filter',
        stateMachines: 'filter_sm',
        label: 'Filter'
      },
      {
        canvasId: 'canvas-price-history',
        artboard: 'price_history',
        stateMachines: 'price_history_sm',
        label: 'Price History'
      },
      {
        canvasId: 'canvas-subs-to-search',
        artboard: 'subs_to_search',
        stateMachines: 'subs_to_search_sm',
        label: 'Subs to Search'
      }
    ];
    
    // Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€Ñ‹ Rive Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ð°
    artboards.forEach(config => {
      const canvas = document.getElementById(config.canvasId);

      const riveInstance = new rive.Rive({
        src: 'plus_onboarding_prod.riv',
        canvas: canvas,
        autoplay: true,
        autoBind: true,
        artboard: config.artboard,
        stateMachines: config.stateMachines,
        layout: new rive.Layout({ fit: rive.Fit.Contain }),
        onLoad: () => {
          console.log(`âœ… Artboard "${config.artboard}" loaded successfully for ${config.label}`);
          riveInstance.resizeDrawingSurfaceToCanvas();

          try {
            // Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº view model Ð½Ð°Ð¿Ñ€ÑÐ¼ÑƒÑŽ Ð¿Ð¾ Ð¸Ð¼ÐµÐ½Ð¸ main_vm
            const viewModelInstance = riveInstance.viewModelInstance.viewModel('main_vm');

            // Ð”Ð¾ÑÑ‚ÑƒÐ¿ Ðº enum Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñƒ language
            const languageEnum = viewModelInstance.enum('language');

            // Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ enum (kz Ð¸Ð»Ð¸ ru)
            languageEnum.value = 'ru';

            console.log(`${config.label} - Current language:`, languageEnum.value);
          } catch (error) {
            console.warn(`${config.label} - View model access failed:`, error.message);
            // ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº view model Ð±ÐµÐ· ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð¸Ð¼ÐµÐ½Ð¸
            try {
              const defaultVM = riveInstance.viewModelInstance;
              console.log(`${config.label} - Default view model available:`, !!defaultVM);
            } catch (vmError) {
              console.warn(`${config.label} - No view model available:`, vmError.message);
            }
          }
        },
        onLoadError: (error) => {
          console.error(`âŒ Failed to load artboard "${config.artboard}" for ${config.label}:`, error);

          // ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚ÑŒ Ð±ÐµÐ· ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ñ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ð°Ñ€Ñ‚Ð±Ð¾Ñ€Ð´Ð° Ð¸ state machine
          console.log(`ðŸ”„ Trying to load ${config.label} without specific artboard...`);
          const fallbackInstance = new rive.Rive({
            src: 'plus_onboarding_prod.riv',
            canvas: canvas,
            autoplay: true,
            layout: new rive.Layout({ fit: rive.Fit.Contain }),
            onLoad: () => {
              console.log(`âœ… Fallback: ${config.label} loaded with default artboard`);
              fallbackInstance.resizeDrawingSurfaceToCanvas();
              canvas.riveInstance = fallbackInstance;
            },
            onLoadError: (fallbackError) => {
              console.error(`âŒ Fallback failed for ${config.label}:`, fallbackError);
              // Ð”Ð¾Ð±Ð°Ð²Ð¸Ð¼ Ñ‚ÐµÐºÑÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð½Ð° canvas
              const ctx = canvas.getContext('2d');
              ctx.fillStyle = 'red';
              ctx.font = '14px Arial';
              ctx.textAlign = 'center';
              ctx.fillText(`Error loading ${config.label}`, canvas.width / 2, canvas.height / 2);
            }
          });
        }
      });

      // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° ÑÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ resize
      canvas.riveInstance = riveInstance;
    });
    
    window.addEventListener('resize', () => {
      artboards.forEach(config => {
        const canvas = document.getElementById(config.canvasId);
        if (canvas.riveInstance) {
          canvas.riveInstance.resizeDrawingSurfaceToCanvas();
        }
      });
    });
  </script>
</body>
</html>